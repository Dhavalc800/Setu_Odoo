<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="operation_task_activity_porject_form_view" model="ir.ui.view">
        <field name="name">operation.task.activity.porject.form.view</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//form/sheet/notebook/page[last()]" position="after">
                <page string="Operation Activity" >
                    <field name="operation_activity_ids" >
                        <tree editable="bottom">
                            <field name="operation_activity_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}" context="{'task_id': parent.id, 'active_id': active_id}" required="True"/>
                            <field name="employee_id" context="{'is_employee': True, 'task_id': task_id}" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}"/>
                            <field name="start_date"/>
                            <field name="end_date" readonly="True"/>
                            <field name="date_deadline"/>
                            <field name="blocked_by" optional="hide"/>
                            <field name="status"/>
                            <field name="taken_days"/>
                            <field name="task_id" invisible="1"/>
                            <field name="project_id" invisible="1"/>
                        </tree>
                    </field>
                </page>
            </xpath>
            
            <xpath expr="//field[@name='user_ids']" position="after">
                <field name="rm_employee_id"/>
                <field name="rm_remark"/>
            </xpath>

            <xpath expr="//field[@name='date_deadline']" position="after">
                <field name="incorporation_date"/>
                <field name="submission_date"/>
                <field name="resubmission_date"/>
            </xpath>
        </field>
    </record>

    <record id="operation_task_activity_tree_view" model="ir.ui.view">
        <field name="name">operation.task.activity.tree.view</field>
        <field name="model">operation.task.activity</field>
        <field name="arch" type="xml">
            <tree string="Operation Task Activity" default_order="date_deadline" create="0" edit="0" delete="0" decoration-danger="end_date &gt;= date_deadline" decoration-success="end_date &lt;= date_deadline">
                <field name="operation_activity_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}" />
                <field name="employee_id" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}" required="1"/>
                <field name="start_date" required="1"/>
                <field name="end_date" readonly="True"/>
                <field name="date_deadline"/>
                <field name="blocked_by" optional="hide"/>
                <field name="status"/>
                <field name="taken_days"/>
                <field name="task_id"/>
                <field name="project_id"/>
                <field name="project_team_ids" widget="many2many_tags" />
            </tree>
        </field>
    </record>

    <record id="view_operation_task_activity_view_pivot" model="ir.ui.view">
        <field name="name">view.operation.task.activity.view.pivot</field>
        <field name="model">operation.task.activity</field>
        <field name="arch" type="xml">
            <pivot string="Operation Task Activity Analysis" sample="1">
                <field name="employee_id" type="col"/>
                <field name="operation_activity_id" type="row"/>
                <field name="status" type="col"/>
                <field name="task_id" type="col"/>
                <field name="start_date" type="row"/>
                <field name="end_date" type="row"/>
                <field name="date_deadline" type="row"/>
                <field name="taken_days" type="row"/>
            </pivot>
        </field>
    </record>

    <record model="ir.ui.view" id="operation_task_activity_search_view">
        <field name="name">operation.task.activity.search.view</field>
        <field name="model">operation.task.activity</field>
        <field name="arch" type="xml">
            <search string="Operation Task Activity Search">
                <field name="operation_activity_id" />
                <field name="employee_id" />
                <field name="project_id"/> 
                <field name="project_team_ids"/>
                <field name="status"/>
                <separator />
                <searchpanel>
                    <field name="employee_id"/>
                </searchpanel>
                <group name="groupby">
                    <filter
                        name="operation_activity_id_groupby"
                        string="Operation Activity"
                        context="{'group_by': 'operation_activity_id'}"
                    />
                    <filter
                        name="employee_groupby"
                        string="Employee"
                        context="{'group_by': 'employee_id'}"
                    />
                    <filter
                        name="status_groupby"
                        string="Status"
                        context="{'group_by': 'status'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_operation_activity_type_config_employee">
        <field name="name">My Operation Task Activity</field>
        <field name="res_model">operation.task.activity</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="operation_task_activity_tree_view" />
        <field name="limit">20</field>
    </record>

    <menuitem id="menu_operation_task_activity_root"
              name="My Operation Task Activity"
              parent="project.menu_main_pm"
              sequence="40"/>

    <menuitem id="menu_operation_task_activity_project"
              name="My Operation Task Activity"
              parent="menu_operation_task_activity_root"
              action="action_operation_activity_type_config_employee"
              sequence="42"/>

</odoo>
