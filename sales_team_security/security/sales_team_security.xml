<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <record id="group_sale_team_manager" model="res.groups">
        <field name="name">User: Team Documents Only</field>
        <field name="comment">
            The user will have an access to the documents of the sales teams he/she belongs to.</field>
        <field name="category_id" ref="base.module_category_sales_sales" />
        <field name="implied_ids" eval="[(4, ref('sales_team.group_sale_salesman'))]" />
    </record>

    <record id="group_booking_branch_manager" model="res.groups">
        <field name="name">Branch Manager</field>
        <field name="category_id" ref="base.module_category_sales_sales" />
        <field name="implied_ids" eval="[(4, ref('sales_team_security.group_sale_team_manager'))]"/>
    </record>

    <record id="sales_team.group_sale_salesman_all_leads" model="res.groups">
        <field name="implied_ids" eval="[(4, ref('sales_team_security.group_booking_branch_manager'))]"/>
    </record>

    <record id="group_booking_invoice_readonly" model="res.groups">
        <field name="name">Invoice Readonly</field>
        <field name="category_id" ref="base.module_category_accounting_accounting" />
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Added invoice readonly Group to implied_ids of billing group-->
    <record id="account.group_account_invoice" model="res.groups">
        <field name="implied_ids" eval="[(4, ref('sales_team_security.group_booking_invoice_readonly'))]"/>
    </record>

    <record id="sale_team_analysis_rule" model="ir.rule">
        <field name="name">Sales Team analysis</field>
        <field ref="sale.model_sale_report" name="model_id"/>
        <field name="domain_force">['|',('user_id','=',user.id),('user_id','=',False)]</field>
        <field name="groups" eval="[(4, ref('sales_team_security.group_sale_team_manager'))]"/>
    </record>

    <record id="sale_order_team_rule" model="ir.rule">
        <field name="name">Team Orders</field>
        <field ref="sale.model_sale_order" name="model_id"/>
        <field name="domain_force">['|','|','|',('user_id','=',user.id),('user_id','=',False), ("team_id", "=", user.sale_team_id.id),("team_id", "in", user.crm_team_member_ids.crm_team_id.ids)]</field>
        <field name="groups" eval="[(4, ref('sales_team_security.group_sale_team_manager'))]"/>
    </record>

    <record id="rule_sale_order_line_team_lead" model="ir.rule">
        <field name="name">Team Orders Lines</field>
        <field name="groups" eval="[(4, ref('sales_team_security.group_sale_team_manager'))]"/>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="domain_force">['|','|',('order_id.team_id.user_id', '=', user.id), ("order_id.team_id", "=", user.sale_team_id.id),("order_id.team_id", "in", user.crm_team_member_ids.crm_team_id.ids)]</field>
        <field name='perm_create' eval='False'/>
        <field name='perm_unlink' eval='False'/>
    </record>


    <record id="sale_order_branch_manager_team_rule" model="ir.rule">
        <field name="name">Branch Manager Team Orders</field>
        <field ref="sale.model_sale_order" name="model_id"/>
        <field name="domain_force">[('team_id', '!=', False),('team_id.branch_manager_id', '!=', False),
             ('team_id.branch_manager_id', '=', user.id),('user_id', '!=', False)]
        </field>
        <field name="groups" eval="[(4, ref('sales_team_security.group_booking_branch_manager'))]"/>
    </record>

    <record id="rule_sale_order_line_bm_lead" model="ir.rule">
        <field name="name">BM Orders Lines</field>
        <field name="groups" eval="[(4, ref('sales_team_security.group_booking_branch_manager'))]"/>
        <field name="model_id" ref="sale.model_sale_order_line"/>
        <field name="domain_force">['|','|',('order_id.team_id.branch_manager_id', '=', user.id), ("order_id.team_id", "=", user.sale_team_id.id),("order_id.team_id", "in", user.crm_team_member_ids.crm_team_id.ids)]</field>
        <field name='perm_create' eval='False'/>
        <field name='perm_unlink' eval='False'/>
    </record>

</odoo>
