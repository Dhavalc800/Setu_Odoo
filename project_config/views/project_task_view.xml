<?xml version="1.0" encoding="utf-8"?>
<odoo>
	    <!-- Inherited form view of project task to add reviwer_id field -->
	    <record id="inherit_form_view_project_task_main_form" model="ir.ui.view">
			<field name="name">project.task.form.new</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.view_task_form2" />
			<field name="arch" type="xml">
				<field name='name' position='after'>
					<field name="state" invisible="1"/>
				</field>
				<xpath expr="//form/sheet/group/group/field[@name='project_id']"
				             position="attributes">
					<attribute name="required">1</attribute>
					<attribute name="options">{'no_open': True,'no_create_edit': True}
					</attribute>
					<attribute name="attrs">{'readonly':[('state','=','done')]}
					</attribute>
				</xpath>
	            <xpath expr="//field[@name='tag_ids']" position="attributes">
	                <attribute name="attrs">{'readonly':[('state','=','done')]}</attribute>
	            </xpath>
	            <xpath expr="//field[@name='partner_id']" position="attributes">
	                <attribute name="attrs">{'readonly':[('state','=','done')]}
	                </attribute>
	            </xpath>
				<field name='user_ids' position='after'>
					<field name="task_type" required="0" 
								attrs="{'readonly':[('state','=','done')]}"/>
					<field name="reviewer_id" required="1"/>
					<field name="planned_hours" widget="float_time"/>
				</field>
	            <field name='date_deadline' position="before">
	                <field name="schedule_date" required="1" />
	            </field>
				<xpath expr="//form/sheet/group/group/field[@name='date_deadline']" position="attributes">
					<attribute name = 'attrs'>{
	                                    'invisible':[('task_type','=','meeting')],
	                                    'readonly':[('state','=','done')]}</attribute>
				</xpath> 
			</field>
		</record> 

	    <!-- inherited view of search view for task type  -->
	    <record id ="project_task_search_view_inherit" model="ir.ui.view">
	        <field name="name">project.task.search.view.inherit</field>
	        <field name="model">project.task</field>
	        <field name ="inherit_id" ref="project.view_task_search_form"/>   
	        <field name="arch" type ="xml">
	            <xpath expr ="/search/field[@name = 'stage_id']" position ="after">
	                <field name="id"/>
	                <field name ="task_type" string="Task Type"/>
	            </xpath>
	            <xpath expr ="/search/group/filter[5]"  position ="after">
	                <filter string="Task Type" name="task_type_filter" context="{'group_by':'task_type'}"/>
	            </xpath>
	<!--             <xpath expr ="/search/filter[@name='message_needaction']"  position ="after">
	                <filter name="month_task" string="Current Month" 
	                
	                domain="['|',('schedule_date','&lt;',(
	                context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), 
	                ('schedule_date','&gt;=',time.strftime('%%Y-%%m-01')),('date_deadline','&lt;',(
	                context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), 
	                ('date_deadline','&gt;=',time.strftime('%%Y-%%m-01'))]"
	                />
	                 domain="[('schedule_date','&lt;',
	                (context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), 
	                ('schedule_date','&gt;=',time.strftime('%%Y-%%m-01'))]" 
	                
	            </xpath> -->
	        </field>
	    </record>


		<record id="project.menu_projects" model="ir.ui.menu">
		    <field name="groups_id" eval="[(4, ref('project_config.group_project_coordinator')), (4, ref('project.group_project_user'))]"/>
		</record>
	
		<record id="project.action_view_all_task" model="ir.actions.act_window">
		    <field name="context">{'search_default_my_tasks': 1,'all_task': 0}</field>
		</record>

		<record id="action_view_task_all" model="ir.actions.act_window">
		    <field name="name">All Tasks</field>
		    <field name="res_model">project.task</field>
		    <field name="view_mode">kanban,tree,form,calendar,pivot,graph,activity</field>
		    <field name="domain">[('display_project_id', '!=', False)]</field>
		    <field name="search_view_id" ref="project.view_task_search_form"/>
			<field name="help" type="html">
		        <p class="o_view_nocontent_smiling_face">
		            No tasks found. Let's create one!
		        </p><p>
		            To get things done, use activities and status on tasks.<br/>
		            Chat in real-time or by email to collaborate efficiently.
		        </p>
		    </field>
		</record>

		<menuitem name="All Tasks" 
			id="menu_project_management_all_task" 
			parent="project.menu_main_pm"
            action="action_view_task_all" sequence="4" 
            groups="hr_config.group_hr_resource"/>

		<record id="quick_create_task_form" model="ir.ui.view">
			<field name="name">project.task.form.quick_create</field>
			<field name="model">project.task</field>
			<field name="inherit_id" ref="project.quick_create_task_form"/>
			<field name="arch" type="xml">
				<xpath expr="//field[@name='user_ids']" position="after">
					<field name="project_id" required="1" />
					<field name="schedule_date" required="1" />
					<field name="reviewer_id" required="1"/>
				</xpath>
			</field>
		</record>
	                    	
</odoo>
