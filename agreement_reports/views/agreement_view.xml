<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="partner_agreement_form_view_inherit" model="ir.ui.view">
            <field name="name">partner.agreement.form.view.inherit</field>
            <field name="model">agreement</field>
            <field name="inherit_id" ref="agreement_legal.partner_agreement_form_view"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='description']" position="after">
                    <group string="Agreement" name="agreement">
                        <field name="agreement_date"/>
                        <field name="booking_date"/>
                        <field name="draft_agreement_temp" invisible="1"></field>
<!--                        <field name="agreement_template" attrs="{'readonly': [('draft_agreement_temp', '=', True)]}"></field>-->
                    </group>
                </xpath>
<!--                <xpath expr="//page[@name='structure']/div" position="after">-->
<!--                    <separator string="Agreement"/>-->
<!--                    <field name="create_template" widget='html'></field>-->
<!--                </xpath>-->
                <xpath expr="//button[@name='create_new_version']" position="after">
                    <button string="Make Draft Agreement" name="make_draft_agreement" 
                    type="object" class="oe_highlight" attrs="{'invisible': [('draft_agreement_temp', '=', True)]}"/>
                </xpath>
                <xpath expr="//div[hasclass('oe_title')]" position="before">
                    <widget name="web_ribbon" title="Not Verified" bg_color="bg-danger" attrs="{'invisible': [('verification_state', '!=', 'not verified')]}"/>
                </xpath>
                <xpath expr="//page[@name='products']/field[@name='line_ids']/tree/field[@name='qty']" position="after">
                    <field name="is_refund" string="Refundable"/>
                    <field name="amount_received" string="Amount Received"/>
                    <field name="tax_id" string="Taxes" widget="many2many_tags"/>
                </xpath>
                <xpath expr="//page[@name='products']" position="attributes">
                    <attribute name="attrs">{'invisible': [('sale_id', '=', False)]}</attribute>
                </xpath>
                <xpath expr="//group[@name='term_information']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <field name="company_id" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>
                <field name="company_id" position="after">
                    <field name="operating_company_id" string="Operating Company" readonly="1"/>
                </field>
                <xpath expr="//group[@name='parties']" position="after">
                    <group name="responsible_user" string="Responsible User">
                        <field name="responsible_user_ids" options="{'no_create': True}" widget="many2many_tags"/>
                    </group>
                </xpath>
                <field name="agreement_type_id" position="attributes">
                    <attribute name="required">1</attribute>
                </field>
                <page name="structure" position="attributes">
                    <attribute name="invisible">1</attribute>
                </page>
                <field name="partner_signed_user_id" position="after">
                    <field
                        name="signed_contract"
                        filename="signed_contract_filename"
                    />
                    <field
                        name="signed_contract_filename"
                        invisible="1"
                    />
                    <field name="verification_state"/>
                    <field name="verified_by" readonly="1"/>
                </field>
                <field name="company_signed_user_id" position="after">
                    <field
                        name="draft_contract"
                        filename="draft_contract_filename"
                    />
                    <field
                        name="draft_contract_filename"
                        invisible="1"
                    />
                </field>
                <field name="stage_id" position="attributes">
                    <attribute name="context">{'agreement_type_id': agreement_type_id}</attribute>
                    <attribute name="domain">['|', ('agreement_type_id', '=', agreement_type_id), ('agreement_type_id', '=', False)]</attribute>
                </field>
                <xpath expr="//page[@name='products']" position="inside">
                     <group colspan="4">
                        <field colspan="2" name="note" nolabel="1" placeholder="Terms and conditions..."/>
                     </group>
                    <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                        <field name="tax_totals" widget="account-tax-totals-field" nolabel="1" colspan="2" readonly="1"/>
                        <field name="payment_received"/>
                    </group>
                </xpath>
                <notebook position="inside">
                    <page string="Payment Details">
                        <field name='payment_plan_line_ids' nolabel="1">
                        <tree editable="bottom">
                            <field name="state"/>
                            <field name="percentage"/>
                            <field name="is_advance"/>
                            <field name="amount"/>
                            <field name="sale_id" invisible="1"/>
                        </tree>
                    </field>
                    </page>
                </notebook>
                <xpath expr="//field[@name='name']" position="after">
                    <field name="active" invisible="1"/>
                </xpath>
                <xpath expr="//div[@name='button_box']" position="after">
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                </xpath>
            </field>
    </record>

    <record id="partner_agreement_list_view_inherit" model="ir.ui.view">
        <field name="name">partner.agreement.list.view.inherit</field>
        <field name="model">agreement</field>
        <field name="inherit_id" ref="agreement_legal.partner_agreement_list_view" />
        <field name="arch" type="xml">
            <field name="agreement_type_id" position="after">
                <field name="total_amount"/>
                <field name="sale_id" optional="hide"/>
                <field name="company_currency_id" invisible="1"/>
                <field name="payment_received" widget="monetary"/>
            </field>
            <field name="company_id" position="replace">
                <field name="operating_company_id"/>
            </field>
        </field>
    </record>

    <record id="agreement_sale_form_view_inherit" model="ir.ui.view">
        <field name="name">agreement.form.view.inherit</field>
        <field name="model">agreement</field>
        <field name="inherit_id" ref="agreement_legal_sale.agreement_sale_form_view" />
        <field name="arch" type="xml">
            <xpath expr="//group[@id='sale_right']" position="inside">
                <field name="payment_plan_id" options='{"no_open": True, "no_create": True}'/>
            </xpath>
        </field>
    </record>

    <!-- Inherited actions to change domain and context-->

    <record model="ir.actions.act_window" id="agreement_legal.agreement_dashboard_agreement">
        <field name="name">Agreements</field>
        <field name="res_model">agreement</field>
<!--        <field name="domain">[(('is_template', '=', False))]</field>-->
        <field
            name="context"
        >{'default_is_template': True, 'default_model': True}</field>
        <field name="view_mode">kanban,tree,form</field>
    </record>

    <record model="ir.actions.act_window" id="agreement_legal.agreement_operations_agreement">
        <field name="name">Agreements</field>
        <field name="res_model">agreement</field>
<!--        <field name="domain">[(('is_template', '=', False))]</field>-->
        <field name="context">{'default_is_template': True}</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record model="ir.actions.act_window" id="agreement_legal.partner_agreement_agreement_templates">
        <field name="name">Templates</field>
        <field name="res_model">agreement</field>
<!--        <field name="domain">[('is_template', '=', True)]</field>-->
        <field name="context">{'default_is_template': True}</field>
        <field name="view_mode">tree,kanban,form</field>
    </record>
    <record model="ir.actions.act_window" id="agreement.agreement_action">
        <field name="name">Agreements</field>
        <field name="res_model">agreement</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_is_template': True}</field>
    </record>

    <record id="project_task_agreement_inherited" model="ir.ui.view">
        <field name="name">project.task.agreement.inherit.form</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button
                    class="oe_stat_button" name="task_agreement_action"
                    type="object" icon="fa-file-text-o" string="Agreement" attrs="{'invisible': [('sale_line_id', '=', False)]}">
                </button>
            </xpath>
        </field>
    </record>

    <record id="agreement_search_view_inherit" model="ir.ui.view">
        <field name="name">agreement.search.view.inherit</field>
        <field name="model">agreement</field>
        <field name="inherit_id" ref="agreement.agreement_search"/>
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="agreement_type_id"/>
                <field name="booking_type"/>
                <field name="stage_id"/>
                <field name="line_ids" string="Product" filter_domain="[('line_ids.product_id', 'ilike', self)]"/>
            </field>
            <group name="groupby" position="after">
                <group string="Group By">
                    <filter string="Operating company" name="operating_company_groupby" context="{'group_by':'operating_company_id'}"/>
                    <filter string="Agreement Type" name="agreement_type_groupby" context="{'group_by':'agreement_type_id'}"/>
                    <filter string="Booking Type" name="booking_type_groupby" context="{'group_by':'booking_type'}"/>
                    <filter string="Stage" name="stage" context="{'group_by':'stage_id'}"/>
                </group>
            </group>
        </field>
    </record>

</odoo>
 
